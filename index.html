<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            touch-action: manipulation;
        }
        canvas {
            background-color: #1a202c; /* Dark background for the game */
            display: block;
            margin: 0 auto;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .touch-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            width: 150px;
            height: 150px;
            margin-top: 20px;
        }
        .touch-btn {
            background-color: #4a5568;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            user-select: none;
        }
        .up { grid-column: 2; grid-row: 1; }
        .left { grid-column: 1; grid-row: 2; }
        .right { grid-column: 3; grid-row: 2; }
        .down { grid-column: 2; grid-row: 3; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-sm mx-auto text-center">
        <h1 class="text-4xl font-bold mb-4">Custom Snake</h1>
        <p class="mb-4 text-gray-400">Use Arrow Keys or Swipe to Move</p>
        
        <!-- Game Canvas -->
        <canvas id="gameCanvas" width="400" height="400"></canvas>

         <!-- Touch Controls for Mobile -->
        <div class="touch-controls md:hidden mx-auto">
            <div class="touch-btn up" id="btn-up">▲</div>
            <div class="touch-btn left" id="btn-left">◀</div>
            <div class="touch-btn right" id="btn-right">▶</div>
            <div class="touch-btn down" id="btn-down">▼</div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center">
        <div class="bg-gray-800 p-8 rounded-lg text-center shadow-lg">
            <h2 class="text-3xl font-bold text-red-500 mb-4">Game Over</h2>
            <p class="text-xl mb-2">Your Score: <span id="finalScore">0</span></p>
            <p class="text-xl mb-6">High Score: <span id="highScore">0</span></p>
            <button id="restartButton" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg">
                Restart
            </button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameOverModal = document.getElementById('gameOverModal');
        const finalScoreEl = document.getElementById('finalScore');
        const highScoreEl = document.getElementById('highScore');
        const restartButton = document.getElementById('restartButton');

        // --- Game Configuration ---
        const GRID_SIZE = 20;
        const TILE_COUNT = canvas.width / GRID_SIZE;
        let snakeHeadImg = new Image();
        snakeHeadImg.src = 'https://image2url.com/images/1755619785973-abbe7d07-eb34-4260-ae81-e87ff5d5ff3b.png';
        snakeHeadImg.onerror = () => {
            console.error("Failed to load image URL. A default color will be used.");
            snakeHeadImg = null; // Set to null to trigger fallback drawing
        };
        let crashSound = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA');

        // --- Game State ---
        let snake = [{ x: 10, y: 10 }];
        let food = { x: 15, y: 15 };
        let velocity = { x: 0, y: 0 };
        let score = 0;
        let highScore = localStorage.getItem('snakeCustomHighScore') || 0;
        let gameOver = false;
        let gameStarted = false;
        let changingDirection = false;

        // --- Main Game Loop ---
        function gameLoop() {
            if (gameOver) return;
            changingDirection = false;
            update();
            draw();
        }

        function update() {
            if (!gameStarted) return;

            const head = { x: snake[0].x + velocity.x, y: snake[0].y + velocity.y };
            snake.unshift(head);

            // Wall collision
            if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
                triggerGameOver();
                return;
            }

            // Self collision
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    triggerGameOver();
                    return;
                }
            }

            // Food collision
            if (head.x === food.x && head.y === food.y) {
                score++;
                generateFood();
            } else {
                snake.pop();
            }
        }

        function draw() {
            // Clear canvas
            ctx.fillStyle = '#1a202c';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw snake
            snake.forEach((segment, index) => {
                if (index === 0) { // Head
                    if (snakeHeadImg && snakeHeadImg.complete) {
                        ctx.drawImage(snakeHeadImg, segment.x * GRID_SIZE, segment.y * GRID_SIZE, GRID_SIZE, GRID_SIZE);
                    } else { // Fallback if image fails
                        ctx.fillStyle = '#48BB78'; // Green
                        ctx.fillRect(segment.x * GRID_SIZE, segment.y * GRID_SIZE, GRID_SIZE - 1, GRID_SIZE - 1);
                    }
                } else { // Body
                    ctx.fillStyle = '#38A169'; // Darker Green
                    ctx.fillRect(segment.x * GRID_SIZE, segment.y * GRID_SIZE, GRID_SIZE - 1, GRID_SIZE - 1);
                }
            });

            // Draw food
            ctx.fillStyle = '#E53E3E'; // Red
            ctx.fillRect(food.x * GRID_SIZE, food.y * GRID_SIZE, GRID_SIZE - 1, GRID_SIZE - 1);
            
            // Draw Score
            ctx.fillStyle = '#fff';
            ctx.font = '20px "Press Start 2P"';
            ctx.fillText(`Score: ${score}`, 10, 25);
            
            if (!gameStarted && !gameOver) {
                ctx.font = '16px "Press Start 2P"';
                ctx.textAlign = 'center';
                ctx.fillText("Press Arrow Key", canvas.width / 2, canvas.height / 2 - 20);
                ctx.fillText("To Start", canvas.width / 2, canvas.height / 2 + 20);
                ctx.textAlign = 'left';
            }
        }

        // --- Helper Functions ---
        function generateFood() {
            food.x = Math.floor(Math.random() * TILE_COUNT);
            food.y = Math.floor(Math.random() * TILE_COUNT);
            // Ensure food doesn't spawn on the snake
            snake.forEach(segment => {
                if (segment.x === food.x && segment.y === food.y) {
                    generateFood();
                }
            });
        }

        function resetGame() {
            snake = [{ x: 10, y: 10 }];
            velocity = { x: 0, y: 0 };
            score = 0;
            gameOver = false;
            gameStarted = false;
            generateFood();
            gameOverModal.classList.add('hidden');
            draw();
        }

        function triggerGameOver() {
            if (gameOver) return;
            crashSound.play();
            gameOver = true;
            gameStarted = false;
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeCustomHighScore', highScore);
            }
            finalScoreEl.textContent = score;
            highScoreEl.textContent = highScore;
            gameOverModal.classList.remove('hidden');
        }

        // --- Event Listeners ---
        function handleDirectionChange(e) {
             if (changingDirection) return;
             changingDirection = true;

            const keyPressed = e.key;
            const goingUp = velocity.y === -1;
            const goingDown = velocity.y === 1;
            const goingRight = velocity.x === 1;
            const goingLeft = velocity.x === 0 && snake.length > 1 ? false : velocity.x === -1;


            if (!gameStarted) gameStarted = true;

            if (keyPressed === "ArrowLeft" && !goingRight) {
                velocity = { x: -1, y: 0 };
            } else if (keyPressed === "ArrowUp" && !goingDown) {
                velocity = { x: 0, y: -1 };
            } else if (keyPressed === "ArrowRight" && !goingLeft) {
                velocity = { x: 1, y: 0 };
            } else if (keyPressed === "ArrowDown" && !goingUp) {
                velocity = { x: 0, y: 1 };
            }
        }
        
        document.addEventListener('keydown', handleDirectionChange);
        restartButton.addEventListener('click', resetGame);

        // Touch controls
        document.getElementById('btn-up').addEventListener('click', () => handleDirectionChange({key: 'ArrowUp'}));
        document.getElementById('btn-down').addEventListener('click', () => handleDirectionChange({key: 'ArrowDown'}));
        document.getElementById('btn-left').addEventListener('click', () => handleDirectionChange({key: 'ArrowLeft'}));
        document.getElementById('btn-right').addEventListener('click', () => handleDirectionChange({key: 'ArrowRight'}));

        // --- Initial Setup ---
        window.onload = () => {
            resetGame();
            setInterval(gameLoop, 1000 / 10); // Game speed: 10 frames per second
        };
    </script>
</body>
</html>
